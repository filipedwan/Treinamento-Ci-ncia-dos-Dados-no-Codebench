var excludeMobileRedirect = ["/fifaworldcup/organisation/ticketing/", "/worldcup/organisation/ticketing/"];define(['frameworks/bundle'],function () {;(function($,w,d) {var sliderModel=fifa.model.extend({initialize:function(options) {var _this=this;fifa.model.prototype.initialize.apply(_this,[options]);},onMove:function(obj_slider,obj,desired_step) {this.triggerView('move',obj_slider,obj,desired_step);},photostreamOnShowAdv:function() {this.triggerView('toggleHiddenAdv',false);},photostreamOnHideAdv:function() {this.triggerView('toggleHiddenAdv',true);},onMoveToPagingIdx:function(pagingIdx) {this.triggerView('moveToPagingIdx',pagingIdx);},name:'slider',view_name:'slider:view'});w.models.slider=new sliderModel({bind:['move','itemClick','showAdv','hideAdv','photostream:hideAdv','photostream:showAdv','moveToPagingIdx']});}(window.jQuery||window.jm,window,document));;(function($,w,d) {var sliderView=fifa.view.extend({initialize:function(options) {var _this=this;fifa.view.prototype.initialize.apply(_this,[options]);_this.triggerMe('init');},coreOnWindowResize:function(screen_width) {var _this=this;_this.triggerMe('init',true);_this.triggerMe('sizeReinit');},onSizeReinit:function() {var _this=this;_this.$el.each(function() {var obj_slider=$(this).data('obj_slider'),anim_obj={},cur_page=obj_slider.$el.attr('data-currentpage')||1;var step=_this.getStep(obj_slider,cur_page);obj_slider.actual_step=cur_page - 1;if("ar"=="en") {anim_obj['right']='-' + (step * obj_slider.item_width) + 'px';}else {anim_obj['left']='-' + (step * obj_slider.item_width) + 'px';}obj_slider.$list.css(anim_obj);_this.triggerMe('prevNextLabelsSet',obj_slider);})},onInit:function(is_reinit) {var _this=this,screenWidth=fifa.getScreenWidth();_this.$el.each(function() {var $el=$(this);if($el.hasClass("slider-mock")) { return;}var _obj={$el:null,items_count:-1,items_per_page:-1,$nav:null,$pagePosCounter:null,$list:null,item_width:null,steps:[],max_steps:0,max_index:0,actual_step:0,defaultItem:0,defaultMode:0,disableNav:false,hasPrevNextLabels:false,prevtNextLabelsTruncate:null};_obj.$el=$el;_obj.$list=$el.find('.slider-list');_obj.$li=_obj.$list.children('li');_obj.items_count=parseInt($el.attr('data-itemscount')||_obj.$li.length,10);if(_obj.$el.attr('data-currentpage')) {_obj.actual_step=_obj.$el.attr('data-currentpage') - 1;}var metaTimelineEdition=d.querySelector('meta[name="competition-timeline-edition"]');if(metaTimelineEdition) {var timelineEdition=metaTimelineEdition.getAttribute('content');if(fifa.is_mobile&&$el.find('.slider-list li[data-timeline-edition="' + timelineEdition + '"]').length>0) {_obj.items_count=parseInt(_obj.$li.length - 1,10);}}_obj.items_per_page=parseInt($el.attr('data-itemsperpage'),10)||1;_obj.max_index=_obj.items_count - _obj.items_per_page;_obj.$nav=$el.find('.slider-nav');_obj.$pagePosCounter=_obj.$nav.find('.page-position-wrap .current-page');_obj.item_width=fifa.is_mobile ? (screenWidth / _obj.items_per_page):_obj.$li.outerWidth(true);_obj.disableNav=(_obj.$nav.attr("disable-nav")||false);_obj.hasPrevNextLabels=($el.attr('data-hasprevnextlabels')||'false')==='true';if(_obj.items_count) {_obj.$list.width(_obj.item_width * _obj.items_count);}if(fifa.is_mobile) {_obj.$li.css('width',_obj.item_width + 'px');$el.width(screenWidth);}if($el.attr('data-defaultmode')=='item') {_obj.defaultMode=1;}_this.triggerMe('navInit',_obj);_this.triggerMe('prevNextLabelsSet',_obj);if(!is_reinit&&_obj.defaultItem) {var index=_obj.defaultItem;var page=parseInt(index / _obj.items_per_page,10) + 1;if(_obj.defaultMode) {if(index>_obj.max_index) {index=_obj.max_index;}if((index % _obj.items_per_page)!=0) {page=page + 1;}_this.triggerMe('move',_obj,null,page,null,index);}else {_this.triggerMe('move',_obj,null,page);}}});fifa.dispatcher.trigger('core:anchorInit');},onNavInit:function(obj_slider) {var _this=this,items=obj_slider.items_count,items_mod=-1,index=0,metaTimelineEdition=d.querySelector('meta[name="competition-timeline-edition"]'),$sliderdefault=obj_slider.$list.find("li[data-sliderdefault='true']");if(metaTimelineEdition&&$sliderdefault.length==0) {var timelineEdition=metaTimelineEdition.getAttribute('content'),$liByEdition=obj_slider.$list.find('li[data-timeline-edition="' + timelineEdition + '"]');var editionText=$liByEdition.find('a').text().trim(),editionImg=$liByEdition.find('.tournament-logo').html();if(!fifa.is_mobile) {$liByEdition.replaceWith('<li class="current-edition noclick"><h4 class="dcm-title">' + editionText + '</h4><div class="tournament-logo">' + editionImg + '</div></li>');}else if(fifa.is_mobile) {$liByEdition.replaceWith('');}var currentEdition=$(metaTimelineEdition).attr("content") - 0;var defaultEdition=0;obj_slider.$list.find("li").each(function() {var _objEdition=$(this).attr("data-timeline-edition") - 0;if(currentEdition<_objEdition) {if(defaultEdition==0) {$sliderdefault=$(this);defaultEdition=_objEdition;}}});}if($sliderdefault.length>0&&!obj_slider.$el.attr('data-currentpage')) {var $firstItem=$($sliderdefault).first();$firstItem.addClass("selected");if(!obj_slider.disableNav) {if($sliderdefault.parents('.matches').length>0) {obj_slider.defaultItem=$firstItem.parents('.matches').index() - 1;}else {obj_slider.defaultItem=$firstItem.index();}}}if(obj_slider.defaultMode) {index=obj_slider.defaultItem;if(index>obj_slider.max_index) {index=obj_slider.max_index;}items=items - index;}while (items>0) {items_mod=items % obj_slider.items_per_page;if(items_mod>0) {obj_slider.steps.push(items_mod);items -= items_mod;}obj_slider.steps.push(obj_slider.items_per_page);items=items - obj_slider.items_per_page;}if(obj_slider.defaultMode&&index) {items=index;while (items>0&&items>=obj_slider.items_per_page) {obj_slider.steps.push(obj_slider.items_per_page);items=items - obj_slider.items_per_page;}if(items) {obj_slider.steps.push(items % obj_slider.items_per_page);}}obj_slider.steps.reverse();obj_slider.max_steps=obj_slider.steps.length - 1;obj_slider.$nav_items=obj_slider.$nav.find('.slider-nav-elm').off('click.slider').on('click.slider',function(e) {e.preventDefault();if(this.className.indexOf(' disabled')>-1) { return;}_this.triggerModel('move',obj_slider,this);});obj_slider.$el.data('obj_slider',obj_slider);if(obj_slider.items_per_page==1) {_this.notifyCurrendPagingIdx(obj_slider,obj_slider.actual_step + 1);}},getStep:function(obj_slider,page) {var step=0;if(page>1) {for (var i=1; i<page; i++) {step += obj_slider.steps[i];}}return step;},onPrevNextLabelsSet:function(obj_slider) {if(!obj_slider.hasPrevNextLabels) { return;}if(obj_slider.actual_step===0) {obj_slider.$nav_items.filter('.nav-prev').find('.nav-label').remove();}else {var $navLabel=obj_slider.$nav_items.filter('.nav-prev').find('.nav-label');if(!$navLabel.length) {$navLabel=$('<span class="nav-label"/>').appendTo(obj_slider.$nav_items.filter('.nav-prev').find('a'));}$navLabel.text(obj_slider.$li.eq(obj_slider.actual_step).find('.prev-label').text().truncate(obj_slider.prevtNextLabelsTruncate));}if(obj_slider.actual_step===obj_slider.max_steps) {obj_slider.$nav_items.filter('.nav-next').find('.nav-label').remove();}else {var $navLabel=obj_slider.$nav_items.filter('.nav-next').find('.nav-label');if(!$navLabel.length) {$navLabel=$('<span class="nav-label"/>').prependTo(obj_slider.$nav_items.filter('.nav-next').find('a'));}$navLabel.text(obj_slider.$li.eq(obj_slider.actual_step).find('.next-label').text().truncate(obj_slider.prevtNextLabelsTruncate));}},onMove:function(obj_slider,nav_item,desired_step,disableNotifications,desiredItem) {var _this=this,className=nav_item ? nav_item.className:'',is_page=(desired_step!=undefined)||(className.indexOf('nav-page-')>-1),is_move_next=className.indexOf('nav-prev')===-1,step=0,anim_obj={},animateCallback=fifa.is_mobile ? function() { _this.triggerMe('prevNextLabelsSet',obj_slider);}:function() {_this.triggerMe('prevNextLabelsSet',obj_slider);var $this=$(this),max_space=obj_slider.item_width * obj_slider.items_per_page,pos_prop="ar"=="en" ? 'right':'left',list_pos_value=+$this.css(pos_prop).replace('px','');if(isNaN(list_pos_value)) { list_pos_value=0;}var $items=$.grep($this.children('li'),function(item) {var client_rect=item.getBoundingClientRect(),item_pos_value=client_rect[pos_prop] + obj_slider.item_width,item_space=item_pos_value - obj_slider.item_width;return (item_space>0&&item_space<=max_space);});fifa.dispatcher.trigger('core:view:unveilImages',$items);};if(is_page) {var page=nav_item ? nav_item.getAttribute('data-page'):desired_step;if(!page) { return;}page=parseInt(page,10);if(page>(obj_slider.max_steps + 1)) { return;}if(page===(obj_slider.actual_step + 1)) { return;}obj_slider.actual_step=page - 1;if(desiredItem) {step=desiredItem;}else {step=_this.getStep(obj_slider,page);}if("ar"=="en") {anim_obj['right']='-' + (step * obj_slider.item_width);}else {anim_obj['left']='-' + (step * obj_slider.item_width);}obj_slider.$list.animate(anim_obj,animateCallback);}else {if(is_move_next) {step=obj_slider.steps[++obj_slider.actual_step];}else {if(obj_slider.defaultMode) {step=obj_slider.steps[--obj_slider.actual_step];}else {step=obj_slider.steps[obj_slider.actual_step--];}}if("ar"=="en") {anim_obj['right']=(is_move_next ? '-':'+') + '=' + (step * obj_slider.item_width);}else {anim_obj['left']=(is_move_next ? '-':'+') + '=' + (step * obj_slider.item_width);}obj_slider.$list.animate(anim_obj,animateCallback);}if(!obj_slider.disableNav) {obj_slider.$nav_items.removeClass('disabled');}if(obj_slider.actual_step<=0) {obj_slider.$nav_items.filter('.nav-prev').addClass('disabled');if(!obj_slider.disableNav) {obj_slider.$nav_items.filter('.nav-next').removeClass('disabled');}if(obj_slider.defaultMode) {_this.reverseStep(step,obj_slider);}}else if(obj_slider.actual_step>=obj_slider.max_steps) {if(!obj_slider.disableNav) {obj_slider.$nav_items.filter('.nav-prev').removeClass('disabled');}obj_slider.$nav_items.filter('.nav-next').addClass('disabled');if(obj_slider.defaultMode) {_this.reverseStep(step,obj_slider);}}obj_slider.$el.attr("data-currentpage",(obj_slider.actual_step + 1)).find(".slider-nav-elm").removeClass("active").end().find(".nav-page-" + (obj_slider.actual_step + 1)).addClass("active");if(obj_slider.$pagePosCounter) {obj_slider.$pagePosCounter.text(obj_slider.actual_step + 1);}if(obj_slider.items_per_page==1&&!disableNotifications) {_this.notifyCurrendPagingIdx(obj_slider,obj_slider.actual_step + 1);}},reverseStep:function(step,obj_slider) {if(step<obj_slider.items_per_page) {obj_slider.steps[obj_slider.actual_step]=obj_slider.items_per_page;if(obj_slider.actual_step) {obj_slider.steps[0]=obj_slider.steps[0] - (obj_slider.items_per_page - step);}else {obj_slider.steps[obj_slider.max_steps]=obj_slider.steps[obj_slider.max_steps] - (obj_slider.items_per_page - step);}}},notifyCurrendPagingIdx:function(obj_slider,listIdx) {var _this=this,pagingId=obj_slider.$list.find('li:nth-child(' + listIdx + ')').attr('paging-id');if(pagingId) {_this.triggerModel('movedToPagingIdx',pagingId);}},onItemClick:function(e) {var $target=$(e.target),$target_li=$target.closest('li');if($target_li.hasClass('noclick')||$target_li.closest('.noclick').is('li')) {return;}if($target_li.hasClass('selected')) {e.preventDefault();return;}this.triggerMe('setSelected',$target_li);this.triggerModel('itemClick',e,$target_li.find('img').attr('data-idx'));},onSetSelected:function($target) {if($target.length) {$target.siblings(".selected").removeClass('selected');$target.addClass('selected');}},onToggleHiddenAdv:function(hidden) {$('.adv-overlay',this.$el).toggleClass('hidden',hidden);},onMoveToPagingIdx:function(pagingIdx) {var _this=this;_this.$el.each(function(i,e) {var obj_slider=$(this).data('obj_slider');var node=obj_slider.$list.find('li[paging-id=' + pagingIdx + ']');if(node) {_this.triggerMe('move',obj_slider,null,node.index() + 1,true);}});},photostreamOnSetPhoto:function(index) {var _this=this;_this.$el.each(function() {var obj_slider=$(this).data('obj_slider');if(!obj_slider) { return;}$('.selected',obj_slider.$list).removeClass('selected');obj_slider.$el.find('.slider-list li:eq(' + (index - 1) + ')').addClass('selected');var desiredStep=Math.floor((index - 1) / obj_slider.items_per_page);_this.triggerMe('move',obj_slider,null,desiredStep + 1);});},tabbedcontentViewOnTabLoaded:function(el) {var _this=this;var obj_slider=(el.find(".slider"));_this.setElement(obj_slider);if(!obj_slider.attr("data-currentpage")) {_this.triggerMe('init');}},customdropdownViewOnItemAjaxSelected:function(el) {var _this=this,slideEl=$(el).parents('.dd-wrapper').parent().find('.slider');_this.setElement(slideEl);_this.triggerMe('init');},events:{'click .slider-list':'onItemClick'},name:'slider:view',model_name:'slider'}),__cfg={el:'.slider',bind:['init','navInit',"customdropdown:view:itemAjaxSelected",'sizeReinit','move','photostream:setPhoto','toggleHiddenAdv','moveToPagingIdx','core:windowResize','setSelected','prevNextLabelsSet','tabbedcontent:view:tabLoaded']};w.views.slider=new sliderView(__cfg);}(window.jQuery||window.jm,window,document)); });
